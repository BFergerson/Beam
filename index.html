<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Beam by CodeBrig</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Beam</h1>
      <h2 class="project-tagline">Client/Server &amp; P2P Networking Library</h2>
      <a href="https://github.com/CodeBrig/Beam" class="btn">View on GitHub</a>
      <a href="https://github.com/CodeBrig/Beam/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/CodeBrig/Beam/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p>Beam is client/server and peer-to-peer compatible networking library. It provides the ability to create large network systems with ease using language-independent messaging protocols. With Beam you can create a server to handle many concurrent connections as well as connect clients to each other for P2P connections. Beam provides the ability for P2P connections through UDP hole punching and UPnP. Message serialization is currently performed by Google's Protocol Buffers (MessagePack and others will be available soon). </p>

<h2>
<a id="overview" class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview</h2>

<ul>
<li>Creating a Server</li>
<li>Message Handlers</li>
<li>Connecting a Client</li>
<li>Creating Messages</li>
<li>Sending Messages</li>
<li>Exchanging Messages</li>
<li>Queuing Messages</li>
<li>Broadcasting Messages</li>
<li>Secure Communication

<ul>
<li>AES</li>
<li>RSA</li>
</ul>
</li>
<li>P2P Connection

<ul>
<li>UPNP Connection</li>
<li>UDP Hole Punching</li>
</ul>
</li>
</ul>

<h2>
<a id="creating-a-server" class="anchor" href="#creating-a-server" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a Server</h2>

<p>This code starts a server on TCP port 45800</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">BeamServer</span> server <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BeamServer</span> (<span class="pl-c1">45800</span>);
server<span class="pl-k">.</span>start ();</pre></div>

<h2>
<a id="message-handlers" class="anchor" href="#message-handlers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Message Handlers</h2>

<p>A Beam server works with message handlers. Each handler has the ability to accept one or more different types of messages</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ExampleHandler</span> <span class="pl-k">extends</span> <span class="pl-e">BasicHandler</span>
{

    <span class="pl-k">public</span> <span class="pl-en">ExampleHandler</span> () {
        <span class="pl-v">super</span> (<span class="pl-smi">ExampleMessage</span><span class="pl-c1"><span class="pl-k">.</span>EXAMPLE_MESSAGE_ID</span>);
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">BeamMessage</span> <span class="pl-en">messageRecieved</span> (<span class="pl-smi">Communicator</span> <span class="pl-v">comm</span>, <span class="pl-smi">BasicMessage</span> <span class="pl-v">msg</span>) {
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Client sent message: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> msg<span class="pl-k">.</span>getString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>));

        <span class="pl-c">//response message</span>
        <span class="pl-k">return</span> msg<span class="pl-k">.</span>emptyResponse ()<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>server_response<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>example_reply_message<span class="pl-pds">"</span></span>);
    }
}</pre></div>

<p>Note: Most handlers extend BeamHandler. BasicHandler is used in this example to allow for easier message manipulation.</p>

<p>Now that you have created a handler you will need to add that handler to the server.</p>

<div class="highlight highlight-source-java"><pre>server<span class="pl-k">.</span>addHandler (<span class="pl-smi">ExampleHandler</span><span class="pl-k">.</span>class);</pre></div>

<p>Note: Add handlers to server before starting to ensure it receives all messages.</p>

<h2>
<a id="connecting-a-client" class="anchor" href="#connecting-a-client" aria-hidden="true"><span class="octicon octicon-link"></span></a>Connecting a Client</h2>

<p>Starting a server creates a thread to handle incoming connections, reading/writing to the socket, and notifying handlers. Now that we have a server created and listening we will need to connect a client to it.</p>

<p>This code connects a client to a server at 127.0.0.1 on TCP port 45800</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">BeamClient</span> client <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BeamClient</span> (<span class="pl-c1">127.0</span><span class="pl-k">.</span><span class="pl-c1">0.1</span>, <span class="pl-c1">45800</span>);
client<span class="pl-k">.</span>connect ();</pre></div>

<h2>
<a id="creating-messages" class="anchor" href="#creating-messages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating Messages</h2>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ExampleMessage</span> <span class="pl-k">extends</span> <span class="pl-e">BasicMessage</span>
{
    <span class="pl-k">public</span> <span class="pl-k">final</span> <span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-c1">EXAMPLE_MESSAGE_ID</span> <span class="pl-k">=</span> <span class="pl-c1">1000</span>;

    <span class="pl-k">public</span> <span class="pl-en">ExampleMessage</span> () {
        <span class="pl-v">super</span> (<span class="pl-c1">EXAMPLE_MESSAGE_ID</span>);
    }

    <span class="pl-k">public</span> <span class="pl-en">ExampleMessage</span> (<span class="pl-smi">BeamMessage</span> <span class="pl-v">message</span>) {
        <span class="pl-v">super</span> (message);
    }

}
</pre></div>

<p>Note: Most messages extends BeamMessage. BasicMessage is being extending in this example to allow for easier message manipulation.</p>

<h2>
<a id="sending-messages" class="anchor" href="#sending-messages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Sending Messages</h2>

<p>Sending a message will send a message and block while waiting for a response.</p>

<p>To create and send a BasicMessage to the server from client</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">ExampleMessage</span> exampleMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ExampleMessage</span> ();
exampleMessage<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>example_client_message<span class="pl-pds">"</span></span>);
<span class="pl-smi">BeamMessage</span> responseMessage <span class="pl-k">=</span> client<span class="pl-k">.</span>sendMessage (exampleMessage);

<span class="pl-c">//convert and output server response</span>
exampleMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ExampleMessage</span> (responseMessage);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Server response: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> exampleMessage<span class="pl-k">.</span>getString (<span class="pl-s"><span class="pl-pds">"</span>server_response<span class="pl-pds">"</span></span>));</pre></div>

<h2>
<a id="exchanging-messages" class="anchor" href="#exchanging-messages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exchanging Messages</h2>

<p>Exchanging a message will send a message and update the original message with the response message given. Useful when the request and response message are the same class as it avoids unnessecary casting like when sending messages.</p>

<p>To create and exchange a BasicMessage to the server from client</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">ExampleMessage</span> exampleMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ExampleMessage</span> ();
exampleMessage<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>example_client_message<span class="pl-pds">"</span></span>);
<span class="pl-k">if</span> (client<span class="pl-k">.</span>exchangeMessage (exampleMessage)) {
    <span class="pl-c">//output server response</span>
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (exampleMessage<span class="pl-k">.</span>getString (<span class="pl-s"><span class="pl-pds">"</span>server_response<span class="pl-pds">"</span></span>));
} <span class="pl-k">else</span> {
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Request timed out!<span class="pl-pds">"</span></span>);
}</pre></div>

<h2>
<a id="queuing-messages" class="anchor" href="#queuing-messages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Queuing Messages</h2>

<p>Queuing a message sends a message without waiting for a response.</p>

<p>To create and queue a BasicMessage to the server from client</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">ExampleMessage</span> exampleMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ExampleMessage</span> ();
exampleMessage<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>example_client_message<span class="pl-pds">"</span></span>);

<span class="pl-c">//queue message. no need to wait for response</span>
client<span class="pl-k">.</span>queueMessage (exampleMessage);</pre></div>

<h2>
<a id="broadcasting-messages" class="anchor" href="#broadcasting-messages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Broadcasting Messages</h2>

<p>As a server you can broadcast messages to all connected clients</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">ExampleMessage</span> exampleMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">ExampleMessage</span> ();
exampleMessage<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>example_broadcast<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>test_value<span class="pl-pds">"</span></span>);

server<span class="pl-k">.</span>broadcast (exampleMessage);</pre></div>

<h2>
<a id="secure-communication" class="anchor" href="#secure-communication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Secure Communication</h2>

<h3>
<a id="aes" class="anchor" href="#aes" aria-hidden="true"><span class="octicon octicon-link"></span></a>AES</h3>

<p>Client</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">AES</span> aes <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">AES</span> (<span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>);
<span class="pl-smi">BeamMessage</span> aesMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">AESBeamMessage</span> (aes, <span class="pl-c1">ENCRYPTED_MESSAGE_ID</span>);
aesMessage<span class="pl-k">.</span>set (<span class="pl-s"><span class="pl-pds">"</span>secret_variable<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>secret_value<span class="pl-pds">"</span></span>);

<span class="pl-c">//send and receive response (response is returned decrypted)</span>
<span class="pl-smi">BeamMessage</span> responseMessage <span class="pl-k">=</span> client<span class="pl-k">.</span>sendMessage (aesMessage);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Server response: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> responseMessage<span class="pl-k">.</span>get (<span class="pl-s"><span class="pl-pds">"</span>server_response<span class="pl-pds">"</span></span>);</pre></div>

<p>Server</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ExampleAESHandler</span> <span class="pl-k">extends</span> <span class="pl-e">AESBeamHandler</span>
{

    <span class="pl-k">public</span> <span class="pl-en">ExampleAESHandler</span> (<span class="pl-smi">AES</span> <span class="pl-v">aes</span>) {
        <span class="pl-v">super</span> (aes, <span class="pl-c1">ENCRYPTED_MESSAGE_ID</span>);
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">BeamMessage</span> <span class="pl-en">messageRecieved</span> (<span class="pl-smi">Communicator</span> <span class="pl-v">comm</span>, <span class="pl-smi">BeamMessage</span> <span class="pl-v">message</span>) {
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Client sent secret: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> message<span class="pl-k">.</span>get (<span class="pl-s"><span class="pl-pds">"</span>secret_variable<span class="pl-pds">"</span></span>));

        <span class="pl-smi">BasicMessage</span> responseMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (<span class="pl-c1">ENCRYPTED_MESSAGE_ID</span>);
        responseMessage<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>server_response<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>server_secret_value<span class="pl-pds">"</span></span>);
        <span class="pl-k">return</span> responseMessage;
    }

}</pre></div>

<h3>
<a id="rsa" class="anchor" href="#rsa" aria-hidden="true"><span class="octicon octicon-link"></span></a>RSA</h3>

<p>Client</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">RSA</span> rsa <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">RSA</span> (<span class="pl-c1">1024</span>);
<span class="pl-smi">RSAConnection</span> rsaConn <span class="pl-k">=</span> client<span class="pl-k">.</span>establishRSAConnection (rsa);
<span class="pl-smi">BeamMessage</span> rsaMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">RSABeamMessage</span> (rsaConn, <span class="pl-c1">ENCRYPTED_MESSAGE_ID</span>);
rsaMessage<span class="pl-k">.</span>set (<span class="pl-s"><span class="pl-pds">"</span>secret_variable<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>secret_value<span class="pl-pds">"</span></span>);

<span class="pl-c">//send and receive response (response is returned decrypted)</span>
<span class="pl-smi">BeamMessage</span> responseMessage <span class="pl-k">=</span> client<span class="pl-k">.</span>sendMessage (rsaMessage);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Server response: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> responseMessage<span class="pl-k">.</span>get (<span class="pl-s"><span class="pl-pds">"</span>server_response<span class="pl-pds">"</span></span>);</pre></div>

<p>Server</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">public</span> <span class="pl-k">class</span> <span class="pl-en">ExampleRSAHandler</span> <span class="pl-k">extends</span> <span class="pl-e">RSABeamHandler</span>
{

    <span class="pl-k">public</span> <span class="pl-en">ExampleRSAHandler</span> (<span class="pl-smi">RSA</span> <span class="pl-v">rsa</span>) {
        <span class="pl-v">super</span> (<span class="pl-c1">ENCRYPTED_MESSAGE_ID</span>);
    }

    <span class="pl-k">@Override</span>
    <span class="pl-k">public</span> <span class="pl-smi">BeamMessage</span> <span class="pl-en">messageRecieved</span> (<span class="pl-smi">Communicator</span> <span class="pl-v">comm</span>, <span class="pl-smi">BeamMessage</span> <span class="pl-v">message</span>) {
        <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Client sent secret: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> message<span class="pl-k">.</span>get (<span class="pl-s"><span class="pl-pds">"</span>secret_variable<span class="pl-pds">"</span></span>));

        <span class="pl-smi">BasicMessage</span> responseMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (<span class="pl-c1">ENCRYPTED_MESSAGE_ID</span>);
        responseMessage<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>server_response<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>server_secret_value<span class="pl-pds">"</span></span>);
        <span class="pl-k">return</span> responseMessage;
    }

}</pre></div>

<p>Note: Server must add a RSAHandshakeHandler with the private RSA</p>

<div class="highlight highlight-source-java"><pre>server<span class="pl-k">.</span>addRSAHandshakeHandler (<span class="pl-k">new</span> <span class="pl-smi">RSAHandshakeHandler</span> (rsa));</pre></div>

<h2>
<a id="p2p-connection" class="anchor" href="#p2p-connection" aria-hidden="true"><span class="octicon octicon-link"></span></a>P2P Connection</h2>

<h3>
<a id="upnp-connection" class="anchor" href="#upnp-connection" aria-hidden="true"><span class="octicon octicon-link"></span></a>UPNP Connection</h3>

<p>Client A</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//opens TCP port 45800 on Client A</span>
<span class="pl-smi">UPNPControl</span> upnpControl <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">UPNPControl</span> (<span class="pl-smi">ConnectionProtocol</span><span class="pl-c1"><span class="pl-k">.</span>TCP</span>);
upnpControl<span class="pl-k">.</span>addPortMapping (<span class="pl-s"><span class="pl-pds">"</span>Example UPNP Connection<span class="pl-pds">"</span></span>, <span class="pl-c1">45800</span>, <span class="pl-c1">45800</span>);

<span class="pl-c">//receive message from Client B</span>
<span class="pl-smi">BeamMessage</span> message <span class="pl-k">=</span> peerComm<span class="pl-k">.</span>fetchWithWait (<span class="pl-smi">Communicator</span><span class="pl-c1"><span class="pl-k">.</span>WAIT_FOREVER</span>, <span class="pl-c1">EXAMPLE_UPNP_MESSAGE</span>);
<span class="pl-smi">BasicMessage</span> basicMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (message);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Client B sent: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> basicMessage<span class="pl-k">.</span>getString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>));

<span class="pl-c">//queue response to Client B</span>
peerComm<span class="pl-k">.</span>queue (basicMessage<span class="pl-k">.</span>emptyResponse ()<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Hello from Client A!<span class="pl-pds">"</span></span>));</pre></div>

<p>Client B</p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">//connect to client A directly on port 45800 (which is open via UPNP)</span>
<span class="pl-smi">BeamClient</span> client <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BeamClient</span> (<span class="pl-c1">CLIENT_IP_ADDRESS</span>, <span class="pl-c1">45800</span>);
client<span class="pl-k">.</span>connect ();

<span class="pl-c">//send message to Client A</span>
<span class="pl-smi">BasicMessage</span> message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (<span class="pl-c1">EXAMPLE_UPNP_MESSAGE</span>);
message<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Hello from Client B!<span class="pl-pds">"</span></span>);
<span class="pl-smi">BeamMessage</span> rtnMessage <span class="pl-k">=</span> peerComm<span class="pl-k">.</span>send (message);

<span class="pl-c">//convert and output Client A response</span>
message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (rtnMessage);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Client A sent: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> basicMessage<span class="pl-k">.</span>getString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>));</pre></div>

<h3>
<a id="udp-hole-punching" class="anchor" href="#udp-hole-punching" aria-hidden="true"><span class="octicon octicon-link"></span></a>UDP Hole Punching</h3>

<p>Client A</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">UDPHoleClient</span> holeClient <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">UDPHoleClient</span> (<span class="pl-c1">PUNCH_SERVER_HOST</span>, <span class="pl-c1">PUNCH_SERVER_PORT</span>);
<span class="pl-smi">Communicator</span> peerComm <span class="pl-k">=</span> holeClient<span class="pl-k">.</span>createHoleCommunicator (<span class="pl-c1">PEER_IDENTIFIER</span>, <span class="pl-c1">PEER_ACCESS_CODE</span>);

<span class="pl-c">//receive message from Client B</span>
<span class="pl-smi">BeamMessage</span> message <span class="pl-k">=</span> peerComm<span class="pl-k">.</span>fetchWithWait (<span class="pl-smi">Communicator</span><span class="pl-c1"><span class="pl-k">.</span>WAIT_FOREVER</span>, <span class="pl-c1">EXAMPLE_PUNCH_MESSAGE</span>);
<span class="pl-smi">BasicMessage</span> basicMessage <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (message);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Client B sent: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> basicMessage<span class="pl-k">.</span>getString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>));

<span class="pl-c">//queue response to Client B</span>
peerComm<span class="pl-k">.</span>queue (basicMessage<span class="pl-k">.</span>emptyResponse ()<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Hello from Client A!<span class="pl-pds">"</span></span>));</pre></div>

<p>Client B</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">UDPPunchClient</span> punchClient <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">UDPPunchClient</span> (<span class="pl-c1">PUNCH_SERVER_HOST</span>, <span class="pl-c1">PUNCH_SERVER_PORT</span>);
<span class="pl-smi">Communicator</span> peerComm <span class="pl-k">=</span> punchClient<span class="pl-k">.</span>punchPeerCommunicator (<span class="pl-c1">PEER_IDENTIFIER</span>, <span class="pl-c1">PEER_ACCESS_CODE</span>);

<span class="pl-k">if</span> (peerComm <span class="pl-k">==</span> <span class="pl-c1">null</span>) {
    <span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Could not find peer to connect to! Make sure peer is waiting with hole request...<span class="pl-pds">"</span></span>);
    <span class="pl-k">return</span>;
}

<span class="pl-c">//send message to Client A</span>
<span class="pl-smi">BasicMessage</span> message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (<span class="pl-c1">TEST_PUNCH_MESSAGE_TYPE</span>);
message<span class="pl-k">.</span>setString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>Hello from Client B!<span class="pl-pds">"</span></span>);
<span class="pl-smi">BeamMessage</span> rtnMessage <span class="pl-k">=</span> peerComm<span class="pl-k">.</span>send (message);

<span class="pl-c">//convert and output Client A response</span>
message <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">BasicMessage</span> (rtnMessage);
<span class="pl-smi">System</span><span class="pl-k">.</span>out<span class="pl-k">.</span>println (<span class="pl-s"><span class="pl-pds">"</span>Client A sent: <span class="pl-pds">"</span></span> <span class="pl-k">+</span> basicMessage<span class="pl-k">.</span>getString (<span class="pl-s"><span class="pl-pds">"</span>client_message<span class="pl-pds">"</span></span>));</pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/CodeBrig/Beam">Beam</a> is maintained by <a href="https://github.com/CodeBrig">CodeBrig</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
